In this chapter we consider geometric set cover problem with weighted segment.
Theorem \ref{w1_hard} proves that this problem is 
W[1]-hard when parametrized by the size of the solution.
We additionally restrict problem to only use segments
in three directions to achieve a stronger result.
W[1]-hardness is proved by redution to a grid tiling problem,
which is introduced in \cite{platypus_book}.

\begin{defi}
	Line is \textbf{right-diagonal} if it is
	described by linear function $y = x + d$ for any $d \in \mathbb{R}$.
	Segment is \textbf{right-diagonal} if its
	direction is a right-diagonal line.
\end{defi}

\begin{tw}
\label{w1_hard}
	Consider the problem of covering a set $\points$ of points
	by selecting at most $k$ segments
	from a set of segments $\sets$ 
	with non-negative weights $w : \sets \rightarrow \mathbb{R^*}$
	so that the weight of the cover is minimal.
	Then this problem is W[1]-hard parameterized by $k$ and
	assuming ETH, there is no algorithm for this
	problem with running time
	$f(k)\cdot(|\points| + |\sets|)^{o(\sqrt{k})}$
	for any computable function $f$.
	Moreover, this holds even if all segments in $\sets$
	are axis-parallel or right-diagonal.
\end{tw}

Theorem \ref{w1_hard} is also true for less
restricted problem where segments have any direction.
We prove more tight setting in this section.

In order to prove Theorem \ref{w1_hard}
we will show reduction from an W[1]-hard problem.
We introduce grid tiling problem, which is proven
to be W[1]-complete in literature.

\begin{defi}
In the \textbf{grid tiling} problem we are given integers $n$ and $k$,
and a function
$f : \{1 \ldots k\} \times \{1 \ldots k\} \rightarrow \wp(\{1 \ldots n\} \times \{1 \ldots n\})$
specifying the set of allowed tiles for each cell of a $k \times k$ grid.
The task is to find functions
$x,y : \{1 \ldots k\} \rightarrow \{1 \ldots n\}$
that assign numbers from $\{1 \ldots n\}$
to respectively columns and rows of the grid,
so that $(x(i), y(j)) \in f(i, j)$ for all valid $i$ and $j$,
or conclude that such an assignment does not exist.
\end{defi}

The next theorem is describing complexity of grid tiling problem.

\begin{tw}
\label{grid_tiling_w1_hard}
Grid tiling is W[1]-hard parametrized by $k$ and
assuming ETH, there is no $f(k)\cdot n^{o(\sqrt{k})}$-time
algorithm solving this problem
for any computable function $f$.
\end{tw}

TODO: proof from reference in literature (platypus book page 490)

The reminder of this section is proving Theorem \ref{w1_hard}
by reduction of grid tiling problem to geometric set cover.
That would prove that geometric set cover is W[1]-hard,
because if we could solve it with an FPT algorithm,
then we could also solve grid tiling problem
(which we reduced to geometric set cover).
Therefore geometric set cover with setting
described in Theorem \ref{w1_hard}
is at least as hard as grid tiling problem.

We start with an instance of the grid tiling problem $(n, k, f)$
size of the
grid $k$, number of colors $n$
and function of allowed tiles
$f : \{1 \ldots k\} \times \{1 \ldots k\} \rightarrow \wp\{1 \ldots n\} \times \{1 \ldots n\}$.

TODO: nice picture of instance of grid tiling with solution

\paragraph{Construction.}
We construct an instance $(\points, \sets, w)$ of geometric set cover as follows.

First let us choose any bijection
$order : \{1, \ldots, n^2\} \rightarrow \{1, \ldots, n\} \times \{1, \ldots, n\}$.

Define $match_v(i, j)$ and $match_h(i, j)$
as functions denoting whether two points share x or y coordinate.

$$match_v(i, j) \iff
order(i) = \{x_i, y_i\} \land order(j) = \{x_j, y_j\} \land x_i = x_j$$

$$match_h(i, j) \iff
order(i) = \{x_i, y_i\} \land order(j) = \{x_j, y_j\} \land y_i = y_j$$


\subparagraph{Points.}

Define points:
	$$h_{i, j, t} = (i \cdot (n^2+1) + t, j \cdot (n^2+1))$$
	$$v_{i, j, t} = (i \cdot (n^2+1), j \cdot (n^2+1) + t)$$
	
Let's define sets $H$ and $V$ as:
$$H = \{h_{i, j, t} : 1 \le i, j, \le k, 1 \le t \le n^2\}$$
$$V = \{v_{i, j, t} : 1 \le i, j, \le k, 1 \le t \le n^2\}$$
	
Let us define $\epsilon = \frac{1}{2k^2}$.
For a point $p = \{x, y\}$ we define points:
$$p^{L} = \{x - \epsilon, y\},$$
$$p^{R} = \{x + \epsilon, y\},$$
$$p^{U} = \{x, y + \epsilon\},$$
$$p^{D} = \{x, y - \epsilon\}.$$

Then we define:
$$\points := H \cup \{p^L : p \in H\} \cup \{p^R : p \in H\}
\cup V \cup \{p^U : p \in V\} \cup \{p^D : p \in V\} $$


\subparagraph{Segments.}
Define horizontal segments.

\newcommand{\hor}[4]{\mathsf{hor}_{#1,#2,#3,#4}}
\newcommand{\ver}[4]{\mathsf{ver}_{#1,#2,#3,#4}}
\newcommand{\horbeg}[2]{\mathsf{horBeg}_{#1,#2}}
\newcommand{\verbeg}[2]{\mathsf{verBeg}_{#1,#2}}
\newcommand{\horend}[2]{\mathsf{horEnd}_{#1,#2}}
\newcommand{\verend}[2]{\mathsf{verEnd}_{#1,#2}}

$$\hor{i}{j}{t_1}{t_2} = (h^R_{i,j,t_1}, h^L_{i+1, j, t_2})$$
$$\ver{i}{j}{t_1}{t_2} = (v^U_{i,j,t_1}, v^D_{i, j+1, t_2})$$

$$\horbeg{i}{t} = (h^L_{1, i, 1}, h^L_{1, i, t})$$
$$\horend{i}{t} = (h^R_{k, i, t}, h^R_{k, i, n^2})$$

$$\verbeg{i}{t} = (v^D_{i, 1, 1}, v^D_{i, 1, t})$$
$$\verend{i}{t} = (v^U_{i, k, t}, v^U_{i, k, n^2})$$

\newcommand{\allhor}{\mathsf{HOR}}
\newcommand{\allver}{\mathsf{VER}}
\newcommand{\alldiag}{\mathsf{DIAG}}

Next we define sets of vertical and horizontal segments:
\begin{eqnarray*}
\allhor &= &\{\hor{i}{j}{t_1}{t_2} : 1 \le i < k, 1 \le j \le k,
1 \le t_1, t_2 \le n^2, match_h(t_1, t_2) holds\} \\
&\cup &\{\horbeg{i}{t} : 1 \le i \le k, 1 \le t \le n^2\}
\\
&\cup &\{\horend{i}{t} : 1 \le i \le k, 1 \le t \le n^2\}
\end{eqnarray*}

\begin{eqnarray*}
\allver &= &\{\ver{i}{j}{t_1}{t_2} : 1 \le i \le k, 1 \le j < k,
1 \le t_1, t_2 \le n^2, match_v(t_1, t_2)\} \\
&\cup &\{\verbeg{i}{t} : 1 \le i \le k, 1 \le t \le n^2\}
\\
&\cup &\{\verend{i}{t} : 1 \le i \le k, 1 \le t \le n^2\}
\end{eqnarray*}

Finally we also define set of right-diagonal segments:
$$\alldiag := \{ (h_{i, j, t}, v_{i, j, t}) :
	1 \le i, j \le k, 1 \le t \le n^2, order(t) \in f(i, j)\}$$

TODO: explain that these segments are in fact diagonal

$$\sets := \allhor \cup \allver \cup \alldiag$$

The weight of each segment in $\allhor \cup \allver$,
while every segment in $\alldiag$ has wieght
$\delta = \frac{1}{4k^4}$.

TODO: Put a picture of small instance like 3x3 with n=2

\begin{equation}
w(s) =
	\begin{cases*}
	  lenghth(s) 			& if $s \in \allhor \cup \allver$ \\
	  \delta        & if $s \in \alldiag$
	\end{cases*}
\end{equation}

\newcommand{\solWeight}{2k^2(n^2+1) - 4k^2\epsilon -4k(1-\epsilon) +k^2\delta }

\begin{lemma}
\label{set_cover_solution_exists}
	If there exists a solution for the grid tiling instance $f_{i,j}$,
	then there exists a solution for the instance $(\points, \sets, w)$
	of geometric set cover
	with weight $\solWeight$.
\end{lemma}

\begin{proof}
	Suppose there exists a solution $x,y$ to the grid tiling problem.
	Then consider a solution that covers
	all points
	$$\{h_{i, j, t} : 1 \le i, j \le k, order(t)=(x(i), y(j))\}
	\cup \{v_{i, j, t} : 1 \le i, j \le k, order(t)=(x(i), y(j))\}$$
	
	with $k^2$ segments from $\alldiag$
	and the rest in $\allver$ or $\allhor$.
	This solution has weight $\solWeight$.
\end{proof}


\begin{claim}
\label{guards}
Points in $\{p^L : p \in H\} \cup \{p^R : p \in H\}$
have to be covered with sgements from $\allhor$.

Points in $\{p^U : p \in V\} \cup \{p^D : p \in V\} $
have to be covered with segments from $\allver$.
\end{claim}


\begin{claim}
\label{one_diag_in_square}
For given $1 \le i, j \le n$
and any solution of an instance $(\points, \sets, w)$
no two points $h_{i, j, t_1}, h_{i, j, t_2}$
($v_{i, j, t_1}, v_{i, j, t_2}$)
for $1 \le t_1 < t_2 \le n^2$
can be not covered with segments from $\allhor$ ($\allver$).
\end{claim}

\begin{proof}
Proof for horizontal segments. Proof for vertical is analoguous.

Assume point $h_{i, j, t_1}$ is not covered with
segments from $\allhor$.
Point $h^R_{i, j, t_1}$ has to be covered with $\allhor$
from Claim $\ref{guards}$.
And every segment in $\allhor$ covering $h^R_{i, j, t_1}$,
but not $h_{i,j,t_1}$ covers also $h_{i, j, t_2}$.
\end{proof}

\begin{lemma}
\label{vertical_horizontal_sum}
For a constructed instance $(\points, \sets, w)$
any solution has to have sum of weights from sets $\allhor$ and $\allver$ at least
$W_{hv} = 2k^2(n^2+1) -4k^2\epsilon -4k(1-\epsilon)$.
\end{lemma}

\begin{proof}
We know that for every $1 \le i,j \le k$
only one there exists only one $t_x$ and $t_y$ such that
$v_{i,j,t_x}$ and $h_{i,j,t_y}$
can be not covered by
segments from $\allhor$ and $\allver$ (Claim \ref{one_diag_in_square}),


We sum the lower bound for sum of length for horizontal/vertical
lines for a single vertical line
(the bound is the same for every horizontal line).

Let us fix $1 \le i \le k$.

\begin{enumerate}[label={(\arabic*)}]
\item Length between $v^D_{i, 1, 1}$ and $v^U_{i, k, n^2}$ is:
$$(k(n^2+1) + n^2 +\epsilon) - ((n^2+1)+1 -\epsilon) = k(n^2+1) - 2(1 - \epsilon).$$

\item For every $1 \le j \le k$ there exists at most one $1 \le t \le n^2$
such that $v_{i,j,t}$ is not covered by segments from $\allver$
(Claim \ref{one_diag_in_square}).
Its guards $v^U_{i,j,t}$ and $v^D_{i,j,t}$
have to be covered in $\allver$ (Claim \ref{guards}).
Therefore at most $k$ spaces of length $2\epsilon$ can be left
not covered by segments from $\allver$.

\end{enumerate}
Therefore sum of these lower bounds for vertical and horizontal lines are:
$$2k(k(n^2+1) -2k\epsilon -2(1-\epsilon)) = 2k^2(n^2+1) -4k^2\epsilon -4k(1-\epsilon)$$
\end{proof}

\begin{lemma}
\label{diag_correct}
For a constructed instance $(\points, \sets, w)$
for any solution $\sol$ with weight equal to $\solWeight$,
for every $1 \le i,j \le k$
there exists such $1 \le t \le n^2$ that:
\begin{enumerate}[label={(\arabic*)}]
\item $v_{i,j,t}, h_{i,j,t}$ are not covered by segments from $\allver$ or $\allhor$;
\item segment $(v_{i,j,t}, h_{i,j,t})$ is in solution $\sol$;
\item $order(t) \in f(i,j)$, ie. it is an allowed tile for $(i,j)$;
\item for every $1 \le s\le n^2$, $s \neq t$, $v_{i,j,s}$ is covered in $\allver$;
\item for every $1 \le s\le n^2$, $s \neq t$, $h_{i,j,s}$ is covered in $\allhor$.
\end{enumerate}
Name the function of this $t$ as
$diagonal : \{1 \ldots k\} \times \{1 \ldots k\} \rightarrow \{1 \ldots n^2\}$.
\end{lemma}

\begin{proof}
At most one $h_{i,j,t_x}$ and $v_{i,j,t_y}$
points are covered with $\alldiag$
(Claim \ref{one_diag_in_square}).
	
Exactly one $h_{i,j,t_x}$ and $v_{i,j,t_y}$
points are covered with $\alldiag$,
because if one of them were not, then we would use too much weight
$$W_{hv} + 2\epsilon > \solWeight$$

This points are covered with the same segment from $\alldiag$,
because we need to use at least $k^2$ of them to use
exactly one DIAG segment for every pair of $1 \le i,j \le k$,
if we used 2 segments from $\alldiag$
for one pair $(i,j)$,
then we would have used too much weight by $\delta$.
Since these points $h_{i,j,t_x}$ and $v_{i,j,t_y}$ are covered by
segment from $\alldiag$, therefore $t_x = t_y$.

Therefore $diagonal(i,j) = t_x = t_y$
and $order(t_x)$ is an allowed tile for $(i,j)$
because the respective segment is in $\alldiag$.

\end{proof}

\begin{lemma}
\label{vertical_horizontal_synchronized}
For a constructed instance $(\points, \sets, w)$
for any solution of weight $\solWeight$ it holds that $diagonal$ function
from Lemma \ref{diag_correct}:
\begin{enumerate}
\item 
for any $1 \le i < k, 1 \le j \le k$,
$match_h(diagonal(i, j),diagonal(i+1, j))$ must be true;
\item 
for any $1 \le i \le k, 1 \le j < k$,
$match_v(diagonal(i, j),diagonal(i, j+1))$ must be true.
\end{enumerate}
\end{lemma}

\begin{proof}
Every space between points in $H$ and $V$ covered by $\allhor$/$\allver$
has to be covered by only one segment, because otherwise it would
use $W_{hv} + \epsilon > \solWeight$,
therefore such solution would be too costly.

Proof for vertical (2), proof for horizontal is analogous.

Let us take any $1 \le i < k, 1 \le j \le k$
and name $t_1 = diagonal(i, j)$ and $t_2 = diagonal(i+1, j)$.
Therefore $h_{i,j,t_1}$ and $h_{i+1,j,t_2}$
are not covered by segments from $\allhor$,
$h^R_{i,j,t_1}$ and $h^L_{i+1,j,t_2}$
have to be covered by segments from $\allhor$ (Claim \ref{guards}).
Every segment from $\allhor$ starts at $h^R_{x,y,z_1}$
segment and finishes at $h^L_{x,y+1,z_2}$ segment for some
$1 \le x \le k$,$1 \le z < k$ and $1 \le z_1, z_2 \le n^2$.
Since all of the points between $h^R_{i,j,t_1}$ and $h^L_{i+1,j,t_2}$
are covered by segments in $\allhor$,
and there are two different segments covering
these points, one of them must begin
at $h^R_{i,j,t_1}$ and end at $h^L_{i,j+1,z_2}$
and the other one begin at $h^R_{i,j,z_1}$
and end at $h^L_{i+1,j,t_2}$
for some $1 \le z_1, z_2 \le n^2$.
Therefore space between $h^R_{i,j,z_1}$ and $h^L_{i,j+1,z_2}$
is covered twice and is longer than $\epsilon$.
By Lemma \ref{vertical_horizontal_sum}
lower bound for weight of such solution is $W_{hv} + \epsilon$
which contradicts that the given solution has size $\solWeight < W_{hv} + \epsilon$
Therefore $h^R_{i,j,t_1}$ and $h^L_{i+1,j,t_2}$ must be covered
by one segment from $\allhor$ and these points are ends of this segment.

$h^R_{i,j,t_1}$ and $h^L_{i+1,j,t_2}$
are ends of a segment from $\allhor$,
therefore $match_h(t_1,t_2)$ must be true.
\end{proof}

\begin{corollary}
\label{vertical_horizontal_synchronized_inductive}
For a constructed instance $(\points, \sets, w)$
for any solution of weight $\solWeight$ it holds that $diagonal$ function
from Lemma \ref{diag_correct}:
\begin{enumerate}
\item 
for any $1 \le i, j \le k$,
$match_h(diagonal(1, j),diagonal(i, j))$ must be true;
\item 
for any $1 \le i, j \le k$,
$match_v(diagonal(i, 1),diagonal(i, j))$ must be true.
\end{enumerate}
\end{corollary}
\begin{proof}
Simple inductive proof based on Lemma \ref{vertical_horizontal_synchronized}.
\end{proof}

\begin{lemma}
\label{grid_tiling_exists}
	If there exists solution of instance $(\points, \sets, w)$
	with weight at most $\solWeight$,
	then there exists a solution for grid tiling instance.
\end{lemma}

\begin{proof}
Take $diagonal$ function from Lemma \ref{diag_correct}.

To define $x$ funtion 
for every $1 \le i \le k$ as $x(i) = x_i$
where $(x_i, a) = order(v_{i,1})$
and $y$ function 
for every $1 \le i \le k$ as $y(i) = y_i$
where $(b, y_i) = order(h_{1,i})$

To prove that it is a correct solution for grid tiling,
we need to prove that 
for every $1 \le i,j \le k$ $(x(i), y(j))$ is in
allowed tiles set $f(i,j)$.

Let us take any $1 \le i,j \le k$,
By Corollary \ref{vertical_horizontal_synchronized_inductive}
we know that $match_h(diagonal(1, j),diagonal(i, j))$ and
$match_v(diagonal(i, 1),diagonal(i, j))$ are true.
Therefore $order(diagonal(i,j)) = (x(i), y(i))$.
By Lemma \ref{diag_correct} we know that 
$order(diagonal(i,j))$ is in $f(i,j)$.
Therefore 
$(x(i), y(i))$
is in $f(i,j)$.

\end{proof}

\begin{proof}[Proof of Theorem \ref{w1_hard}]
Based on Lemmas \ref{set_cover_solution_exists} and \ref{grid_tiling_exists}
this is true.
\end{proof}
