\section{FPT for weighted segments with $\delta$-extensions}

In this section we consider a geometric set cover problem
for weighted segments relaxed with $\delta$-extensions.
We show that this problem
admits an FPT algorithm when parametrized with size
of solution and $\delta$.
Assumption about the problem being relaxed with $\delta$-extensions is relevant.
In next chapter we show that geometric set cover problem
for weighted segments is W[1]-hard, that means
there does not exist an FPT algorithm parametrized by solution size for it.

\begin{tw}[FPT for weighted segment cover with $\delta$-extensions]{
	\label{fpt_weighted_segment}
	There exists an algorithm that given a family $\sets$ of
	$n$ weighted segments (in any direction),
	a set of $m$ points $\points$, and parameters $k$ and $\delta > 0$,
	runs in time $f(k, \delta) \cdot (nm)^c$ for some computable function $f$ and a constant $c$,
	and outputs a set $\sol \subseteq \sets$
	such that $|\sol| \le k$ and $\sol^{+\delta}$ covers all points in $\points$,
	or determines that such a set $\sol$ does not exist.
}\end{tw}


To solve this problem we will introduce a lemma about choosing
a \textit{good} subset of points. Good subset of points
for a set of collinear points $C$ and parameters $k$ and $\delta$
is a subset of $C$, such that
if we cover good subset of $C$ with at most $k$ segments,
these segments after $\delta$-extensions will cover all of the points from $C$.

Such set of size bounded by some function $f(k, \delta)$ always exists.
In later part of the section this lemma will allow us to find a kernel
for our orginal problem.

\begin{defi}
	For a set of collinear points $C$,
	a subset $A \subseteq C$ is \textbf{$(k,\delta)$-good} 
	if for any set of segments $R$ that covers $A$ and
	such that $|R| \le k$, it holds that $R^{+\delta}$ covers $C$.
\end{defi}

\begin{lemma}
	\label{good_set_exists}
	There exists an algorithm that
	for any set of collinear points $C$, $\delta > 0$ and $k \ge 1$,
	outputs a $(k,\delta)$-good set $A \subseteq C$ of size
	at most $(2+\frac{2}{\delta})^k$.
	Moreover it can be computed in time $O(|C| \cdot (2+\frac{2}{\delta}))$.
\end{lemma}

To prove this theorem we also define \textit{extreme points}
for a set of colinear points.

\begin{defi}
	For a set of collinear points $C$,
	\textbf{extreme points} are the ends
	of the smallest segment that covers all points from set $C$.
	
	If $C$ consists of one point or is empty, then
	there exists 1 or 0 extreme points respectively.
\end{defi}

\begin{proof}[Proof of Lemma \ref{good_set_exists}]
We prove this for a fixed $\delta$ by induction over $k$.

\subparagraph{Inductive hypothesis.}
For any set of collinear points $C$, there exists a set $A$ such that:
\begin{itemize}
\item $A$ is subset of $C$,
\item $A$ is $(\ell, \delta)$-good for every $1 \le \ell \le k$,
\item $|A| \le (2+\frac{2}{\delta})^k$,
\item extreme points from $C$ are in $A$.
\end{itemize}

\subparagraph{Base case for $k = 1$.}
It is sufficient that $A$ consists of extreme points of $C$.

If they are covered with one segment, it must be a segment 
that includes the extreme points from $C$, so it covers the whole set $C$.

There are at most 2 extreme points in $C$ and $2 < 2+\frac{2}{\delta}$.

\subparagraph{Inductive step.}
Assuming inductive hypothesis for any set of collinear points $C$
and for parameter $k$, we will prove hypothesis for $k+1$.

Let $s$ be the minimal segment that includes all points from $C$.
That is, the extreme points of $C$ are endpoints of $s$.

We define $M = \lceil1+\frac{2}{\delta}\rceil$ subsegments of $s$ in the following way.
We split $s$ into $M$ closed segments of equal length.
We name these as segments $v_i$ and
$|v_i| = \frac{|s|}{M}$ for each $1 \le i \le M$.

Let $C_i$ be the subset of $C$ consisting of points laying on $v_i$.

Let $t_i$ be the segment with endpoints being the extreme points of $C_i$.
It might be degenerated segment if $C_i$ consists of one point
or empty if $C_i$ is empty.

\begin{figure}[h]
\centering
\def\svgwidth{\columnwidth}
\input{fpt_v_t_def.pdf_tex}
\caption{\textbf{Example of segments $v_i$ and $t_i$.}}
Example for $M = 8$ and some set of points.
Red segments denote split into $M$ segments of equal length $v_i$.
Blue segments denote segments $t_i$. $t_5$ is an empty segment,
because there are no points that lie on segment $v_5$.
Segments $t_4$ and $t_8$ are degenerated to one point --
$c$ and $d$ respectively.
Segments $t_1$ and $t_2$ share one point $b$.
\label{fig:fpt_v_f_def}
\end{figure}

We use the inductive hypothesis to choose $(k, \delta)$-good sets $A_i$
for sets $C_i$. Note that if $|C_i| \le 1$, then $A_i = C_i$
and it's still a $(k, \delta)$-good set for $C_i$.

Then we define $A = \bigcup_{i=1}^{M} A_i$.
Thus $A$ includes the extreme points of $C$,
because they are included in the sets $A_1$ and $A_M$.

Size of each $A_i$ is at most $(2+\frac{2}{\delta})^(k-1)$ from inductive
hypothesis, therefore size of $A$ is at most:
$$M(2+\frac{2}{\delta})^{(k-1)} =
\lceil1+\frac{2}{\delta}\rceil\cdot(2+\frac{2}{\delta})^{(k-1)}
\le (2+\frac{2}{\delta})^k$$


\subparagraph{Proof that $A$ is $(k, \delta)$-good for $C$.}
Let us take any cover of $A$ with $k+1$ segments and call it $\sol$.

For every segment $t_i$, if there exists a segment $x$ in $\sol$ 
that is disjoint with $t_i$,
then we have a cover of $A_i$ with at most $k$
segments using $\sol - \{x\}$.
Since $A_i$ is $(k, \delta)$-good for $t_i$ and $C_i$,
then $(\sol - \{x\})^{+\delta}$ covers $C_i$.
So $\sol^{+\delta}$ covers $C_i$ as well.

If there exists a segment $t_i$ for which a segment $x$ as defined above
does not exist, then all $k+1$ segments that cover
$A_i$ intersect with $t_i$.
Note that there may exist only one such segment $t_i$.
From the inductive hypothesis endpoints of $s$ are
in $A_1$ and $A_M$ respectively, so $\sol$ must cover them.
For each endpoint of $s$, there exists
a segment that starts in this endpoint and ends somewhere in $t_i$.
Let us call these two segments $y$ and $z$. It follows that:
$|y| + |z| + |t_i| \ge |s|$.
Since $|t_i| \le |v_i| = \frac{|s|}{M} \le \frac{|s|}{1+\frac{2}{\delta}} = \frac{|s|\delta}{\delta+2}$,
we have $\max(|y|, |z|) \ge |s|(1-\frac{\delta}{\delta+2})/2 = \frac{|s|}{\delta+2}$.

\begin{figure}[h]
\centering
\def\svgwidth{\columnwidth}
\input{fpt_tricky_case.pdf_tex}
\caption{\textbf{Example of a tricky case.}}
This shows an example.
\label{fig:fpt_tricky_case}
\end{figure}

After $\delta$-extension, the longer of these segments will
expand at both ends by at least:
$$\frac{|s|\delta}{\delta+2} = \frac{|s|}{1+\frac{2}{\delta}} \ge \frac{|s|}{M} = v_i \ge t_i.$$

Therefore the longer of segments $y$ and $z$ will cover the whole segment $t_i$
after $\delta$-extension. We conclude that $\sol^{+\delta}$ covers $C_i$.

Since $C = \bigcup_{i=1}^M C_i$,
it follows that $\sol^{+\delta}$ covers $C$.


\subparagraph{Algorithm.}

We can simulate the inductive proof by a recursive algorithm.

TODO: Maybe just say "it's easy to implement"?

We apply recursion for each subset $C_i$. Every point
from $C$ belongs to at most 2 sets $C_i$.

Apart from recursive algorithm we perform operations linear in
$|C| + M$ to calculate the sets $C_i$.

Therefore the algorithm has complexity:
$$O(|C|+M) + \sum_i^M O(|C_i|k(1+\frac{1}{\delta})) = 
O(|C| + (1+\frac{1}{\delta})) + O((\sum_i^M |C_i|)k(1+\frac{1}{\delta}))
\le O(|C|k(1+\frac{1}{\delta})).$$

\end{proof}

Let us now formulate some claims about the
properties for the problem parametrized by the solution size.
These properties provide bounds for different
objects in the problem instance,
that help us to find small kernel of the problem
or claim that the minimal
solution of this instance must be above some treshold.

\begin{defi}
A line in $\mathbb{R}$ is \textbf{long} if there are at least $k+1$ points from $\points$ on it.
\end{defi}

\begin{claim}
\label{few_long_lines}
If there are more than $k$ different long lines, then 
$\points$ can not be covered with $k$ segments.
\end{claim}

\begin{proof}
We prove the claim by contradiction.
Let us assume that we have at least $k+1$ different
long lines in our instance of the problem
and solution $\sol$ of size at most $k$
covering points $\points$.

Choose any long line $L$.
Every segment from $\sol$, which is not collinear with $L$,
covers at most one point that lies on $L$.

$L$ is long, so there are at least $k+1$ points from $\points$ that lie on $L$.
That implies that there must be a segment in $\sol$ that is
collinear with $L$.

Since we have at least $k+1$ different long lines,
then there are at least $k+1$
segments in $\sol$ collinear with different lines.
It contradicts with the assumption that $|\sol| \le k$.
\end{proof}

\begin{claim}
\label{few_points}
If there are more than $k^2$ points from $\points$
that do not lie on any long line,
then $\points$ can not be covered with $k$ segments.
\end{claim}

\begin{proof}
We prove the claim by contradiction.
Let us assume that we have at least $k^2+1$ points
from $\points$ that do not lie on any long line, call this set $A$,
and a solution $\sol$ of size at most $k$ covering points $\points$.

For every segment $s$ from $\sol$ it covers at most $k$
points from $A$.
It holds because if $s$ covered at least $k+1$ points from $A$,
then the line in the direction of $s$ would be a long line
and that contradicts of definiton of $A$.

If every segment from $\sol$ covers at most $k$ points from $A$
and $|\sol| \le k$, then at most $k^2$ points from $A$ are covered by $\sol$
and that contradicts the fact that $\sol$ is a solution of given
geometric set cover instance.
\end{proof}

We are now ready to give a proof of Theorem \ref{fpt_weighted_segment}
algorithm.

\begin{proof}[Proof of Theorem \ref{fpt_weighted_segment}]

Applying the claims \ref{few_long_lines} and \ref{few_points},
if we have more than $k$ different long lines
or more than $k^2$ points from $\points$
that do not lie on any long line, then we answer that
there is no solution of size at most $k$.

Otherwise, we can split $\points$ into at most $k+1$ sets:
\begin{itemize}
\item $D$, at most $k^2$ points that do not lie on any long line;
\item $C_i$, points that lie on $i$-th long line.
\end{itemize}
Sets $C_i$ do not need to be disjoint.

Then for every set $C_i$ we can use Lemma \ref{good_set_exists}
to obtain a $(k,\delta)$-good set $A_i$
for $C_i$ with $|A_i| \le (2+\frac{2}{\delta})^k$.

Then we have a set $\points' = D \cup \bigcup A_i$ of size at most $f(k, \delta)$
for some computable function $f$.
Observe that if we have a solution $\sol$ of size at most $k$
that covers $\points'$, then $\sol^{+\delta}$ covers $\points$.

$\points$ is separated into several parts -- sets $D$ and $C_i$.
Points from $D$ are covered by $\sol$, because $D$ is part of $\points'$.
Each $A_i$ is covered, because $A_i$ is part of $\points'$;
$A_i$ is a $(k,\delta)$-good set for $C_i$, therefore $\sol^{+\delta}$ covers $C_i$.

After that we shrunk down $\points$ to $\points'$ of size $f(k, \delta)$
for some computable function $f$.
Then we would like to shrink down $\sets$ to some set of
interesting segments of bounded size as well.

For every pair of points $\points'$, we can choose one segment from
$\sets$ that have the lowest weight
among segments that cover these points 
or decide there is no segment that cover them.
Call this set $\sets'$ and name these segments \textbf{interesting}.
There are at most $|\points'|^2$ different segments in $\sets'$.

We need to show that when we cover $\points'$
with segments from $\sets'$ we achieve the same minimal
solution as when we cover them with segments from $\sets$. 
In order to prove this,
consider a minimal solution $\sol$ that covers $\points'$
with segments from $\sets'$
and take any segment $s$ from $\sol$.
Let us look at the points from $\points'$ that lie on $s$
and call this set of points $F$.
$F$ is a set of collinear points for course.
We can cover $F$ with any segment that covers extreme points of $F$,
because all other points lay on the segment between these points.
Therefore we can change $s$ to an interesting segment $s'$
and interesting segments are defined in such a way, that $s'$
has weight no larger than weight of $s$.

This has complexity $O(|\points'|^2|\sets|)$ and produce shrunk down
set of segments $\sets'$ of size $f(k, \delta)$
for some computable function $f$.

Then we can iterate over all subsets of $\sets'$ and
choose the set with the lowest sum of weights that cover $\points'$.
This solution
would have weight not larger than optimal solution
for the problem without extension, because we iterate
over all posibilities of covering the subset of $\points'$.
\end{proof}

